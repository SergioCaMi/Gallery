<%- include("template/cabecera", { title: "Detalles de la Imagen" }) %>

<!-- Muestra la imagen grande -->
<%- include("template/imageCard.ejs", { dataImage: dataImage }) %>

<!-- Contenedor principal -->
<div class="image-details-wrapper">
  <div class="image-details-container-modern">
    <% if (dataImage && dataImage.length > 0) { %>
      <% const image = dataImage[0]; %>

      <!-- Información Principal -->
      <div class="detail-card info-card">
        <div class="card-header">
          <i class="fas fa-info-circle"></i>
          <h3>Información General</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <span class="info-label"><i class="fas fa-heading"></i> Título:</span>
            <span class="info-value"><%= image.title || 'Título no disponible' %></span>
          </div>
          <div class="info-row">
            <span class="info-label"><i class="fas fa-calendar-alt"></i> Fecha:</span>
            <span class="info-value"><%= image.date ? new Date(image.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Fecha no disponible' %></span>
          </div>
          <div class="info-row">
            <span class="info-label"><i class="fas fa-align-left"></i> Descripción:</span>
            <span class="info-value"><%= image.description || 'Sin descripción' %></span>
          </div>
          <div class="info-row">
            <span class="info-label"><i class="fas fa-link"></i> URL:</span>
            <span class="info-value url-value"><%= image.urlImagen || 'URL no disponible' %></span>
          </div>
        </div>
      </div>

      <!-- Colores -->
      <div class="detail-card colors-card">
        <div class="card-header">
          <i class="fas fa-palette"></i>
          <h3>Colores Principales</h3>
        </div>
        <div class="card-body">
          <% if (image.colors && image.colors.length) { %>
            <div class="color-grid">
              <% image.colors.forEach(function(color) { %>
                <% let rgb = Array.isArray(color._rgb) ? color._rgb : [0, 0, 0, 1] %>
                <div class="color-item">
                  <div class="color-circle-large" style="background-color: rgba(<%= rgb.join(',') %>);"></div>
                  <span class="color-code">rgba(<%= rgb.slice(0,3).join(', ') %>)</span>
                </div>
              <% }) %>
            </div>
          <% } else { %>
            <p class="no-data"><i class="fas fa-exclamation-triangle"></i> Colores no disponibles</p>
          <% } %>
        </div>
      </div>

      <!-- Datos EXIF -->
      <div class="detail-card exif-card">
        <div class="card-header">
          <i class="fas fa-camera"></i>
          <h3>Datos EXIF</h3>
        </div>
        <div class="card-body">
          <% if (image.exif) { %>
            <!-- Cámara -->
            <div class="exif-section-modern">
              <h5><i class="fas fa-camera-retro"></i> Cámara</h5>
              <div class="exif-grid">
                <div class="exif-item">
                  <span class="exif-label">Fabricante:</span>
                  <span class="exif-value"><%= image.exif.Make || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Modelo:</span>
                  <span class="exif-value"><%= image.exif.Model || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Flash:</span>
                  <span class="exif-value"><%= image.exif.Flash || 'N/A' %></span>
                </div>
              </div>
            </div>

            <!-- Parámetros de Disparo -->
            <div class="exif-section-modern">
              <h5><i class="fas fa-sliders-h"></i> Parámetros de Disparo</h5>
              <div class="exif-grid">
                <div class="exif-item">
                  <span class="exif-label">Exposición:</span>
                  <span class="exif-value"><%= image.exif.ExposureTime || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Apertura:</span>
                  <span class="exif-value">f/<%= image.exif.FNumber || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">ISO:</span>
                  <span class="exif-value"><%= image.exif.ISO || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Longitud focal:</span>
                  <span class="exif-value"><%= image.exif.FocalLength || 'N/A' %> mm</span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Balance blancos:</span>
                  <span class="exif-value"><%= image.exif.WhiteBalance || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Modo exposición:</span>
                  <span class="exif-value"><%= image.exif.ExposureMode || 'N/A' %></span>
                </div>
              </div>
            </div>

            <!-- Fechas -->
            <div class="exif-section-modern">
              <h5><i class="fas fa-clock"></i> Fechas</h5>
              <div class="exif-grid">
                <div class="exif-item">
                  <span class="exif-label">Fecha original:</span>
                  <span class="exif-value"><%= image.exif.DateTimeOriginal || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Creación:</span>
                  <span class="exif-value"><%= image.exif.CreateDate || 'N/A' %></span>
                </div>
                <div class="exif-item">
                  <span class="exif-label">Modificación:</span>
                  <span class="exif-value"><%= image.exif.ModifyDate || 'N/A' %></span>
                </div>
              </div>
            </div>

            <!-- GPS -->
            <% if (image.exif.latitude && image.exif.longitude) { %>
              <div class="exif-section-modern">
                <h5><i class="fas fa-map-marker-alt"></i> Ubicación GPS</h5>
                <a href="https://www.google.com/maps?q=<%= image.exif.latitude %>,<%= image.exif.longitude %>" target="_blank" class="gps-link">
                  <i class="fas fa-external-link-alt"></i> Ver en Google Maps
                  <span class="coordinates">(<%= image.exif.latitude.toFixed(6) %>, <%= image.exif.longitude.toFixed(6) %>)</span>
                </a>
              </div>
            <% } %>
          <% } else { %>
            <p class="no-data"><i class="fas fa-exclamation-triangle"></i> Datos EXIF no disponibles</p>
          <% } %>
        </div>
      </div>

      <!-- Botón volver -->
      <div class="details-bottom-modern">
        <a href="/" class="btn-back-modern">
          <i class="fas fa-arrow-left"></i> Volver al inicio
        </a>
      </div>

    <% } else { %>
      <div class="no-image-modern">
        <i class="fas fa-image"></i>
        <h2>Imagen no encontrada</h2>
        <a href="/" class="btn-back-modern">
          <i class="fas fa-arrow-left"></i> Volver al inicio
        </a>
      </div>
    <% } %>
  </div>
</div>

<%- include("template/footer") %>

<script>
  const imageData = <%= JSON.stringify(dataImage[0] || null) %>;
</script>
